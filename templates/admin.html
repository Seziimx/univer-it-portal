{% extends "base.html" %}

{% block title %}Admin Panel{% endblock %}

{% block content %}
<h1 style="text-align: center; font-family: 'Kaushan Script', cursive; margin-bottom: 20px;">–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h1>

<!-- –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
<form id="filter-form" style="display: flex; gap: 15px; margin-bottom: 20px; align-items: center;">
    <select id="filter-type" class="input-box styled-dropdown" style="flex: 1;">
        <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
        <option value="–ö–∞—Ä—Ç—Ä–∏–¥–∂ Canon 737">–ö–∞—Ä—Ç—Ä–∏–¥–∂ Canon 737</option>
        <option value="HDMI —Å–ø–ª–∏—Ç–µ—Ä 4-1 —Å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–º">HDMI —Å–ø–ª–∏—Ç–µ—Ä 4-1 —Å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–º</option>
        <option value="SSD Kingston SA400S37 480 Gb">SSD Kingston SA400S37 480 Gb</option>
        <option value="USB Flash –∫–∞—Ä—Ç–∞ Kingston DTXM/256 GB">USB Flash –∫–∞—Ä—Ç–∞ Kingston DTXM/256 GB</option>
        <option value="–ú—ã—à—å –ø—Ä–æ–≤–æ–¥–Ω–∞—è Logitech B100">–ú—ã—à—å –ø—Ä–æ–≤–æ–¥–Ω–∞—è Logitech B100</option>
        <option value="–ú–æ–Ω–∏—Ç–æ—Ä Samsung 24">–ú–æ–Ω–∏—Ç–æ—Ä Samsung 24"</option>
        <option value="–í–µ–±-–∫–∞–º–µ—Ä–∞ Logitech C270">–í–µ–±-–∫–∞–º–µ—Ä–∞ Logitech C270</option>
        <option value="–ù–∞—É—à–Ω–∏–∫–∏ —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–æ–º Defender">–ù–∞—É—à–Ω–∏–∫–∏ —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–æ–º Defender</option>
        <option value="–ü—Ä–æ–µ–∫—Ç–æ—Ä ViewSonic">–ü—Ä–æ–µ–∫—Ç–æ—Ä ViewSonic</option>
        <option value="–ö–∞—Ä—Ç—Ä–∏–¥–∂ HP CF283A (83A)">–ö–∞—Ä—Ç—Ä–∏–¥–∂ HP CF283A (83A)</option>
        <option value="–ß–∏–ø –¥–ª—è –∫–∞—Ä—Ç—Ä–∏–¥–∂–∞ HP 83A">–ß–∏–ø –¥–ª—è –∫–∞—Ä—Ç—Ä–∏–¥–∂–∞ HP 83A</option>
        <option value="–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ Smartbuy ONE 101">–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ Smartbuy ONE 101</option>
        <option value="–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –∑–∞—Ä—è–¥–∫–∞ –¥–ª—è –Ω–æ—É—Ç–±—É–∫–æ–≤">–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –∑–∞—Ä—è–¥–∫–∞ –¥–ª—è –Ω–æ—É—Ç–±—É–∫–æ–≤</option>
        <option value="–ü—Ä–∏–Ω—Ç–µ—Ä Brother HL-L2365">–ü—Ä–∏–Ω—Ç–µ—Ä Brother HL-L2365</option>
        <option value="–°–µ—Ç–µ–≤–æ–π —Ñ–∏–ª—å—Ç—Ä 5 —Ä–æ–∑–µ—Ç–æ–∫">–°–µ—Ç–µ–≤–æ–π —Ñ–∏–ª—å—Ç—Ä 5 —Ä–æ–∑–µ—Ç–æ–∫</option>
        <option value="–ö–∞–±–µ–ª—å HDMI 1.5–º">–ö–∞–±–µ–ª—å HDMI 1.5–º</option>
        <option value="–ö–∞–±–µ–ª—å USB‚ÄìmicroUSB">–ö–∞–±–µ–ª—å USB‚ÄìmicroUSB</option>
        <option value="–ü–∞–ø–∫–∞ –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ A4">–ü–∞–ø–∫–∞ –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ A4</option>
        <option value="–ë–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è ATX 500W">–ë–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è ATX 500W</option>
        <option value="–†–æ—É—Ç–µ—Ä TP-Link Archer C20">–†–æ—É—Ç–µ—Ä TP-Link Archer C20</option>
        <option value="–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ">–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</option>
        <option value="–†–µ–º–æ–Ω—Ç">–†–µ–º–æ–Ω—Ç</option>
    </select>
    <select id="filter-status" class="input-box styled-dropdown" style="flex: 1;">
        <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
        <option value="–æ–∂–∏–¥–∞–µ—Ç">–û–∂–∏–¥–∞–µ—Ç</option>
        <option value="—Å–¥–µ–ª–∞–Ω–æ">–°–¥–µ–ª–∞–Ω–æ</option>
        <option value="–æ—Ç–∫–ª–æ–Ω–µ–Ω–æ">–û—Ç–∫–ª–æ–Ω–µ–Ω–æ</option>
        <option value="—Å–¥–µ–ª–∞–Ω–æ">–°–¥–µ–ª–∞–Ω–æ</option>
        <option value="–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</option>
    </select>
    <input id="filter-query" type="text" placeholder="–ü–æ–∏—Å–∫..." class="input-box styled-input" style="flex: 2;">
    <button type="button" id="apply-filters" class="btn styled-btn" style="width: 173px; height: 44px; font-size: 16px; border-radius: 8px;">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
</form>

<!-- –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ -->
<div class="scrollable-section" style="flex: 1; overflow-y: auto; padding-right: 10px;">
    <h2 style="margin-bottom: 20px; color: #333;">–°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫</h2> <!-- Explicitly set text color -->
    <div id="request-list" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; padding: 10px; max-height: 75vh; overflow-y: auto;">
        {% if zayavki %}
            {% for z in zayavki %}
            <div class="card {% if z.urgent %}urgent{% endif %}" 
                 data-type="{{ z.type }}" 
                 data-status="{{ z.status }}" 
                 data-description="{{ z.description | lower }}" 
                 data-username="{{ z.user.username | lower }}" 
                 data-fullname="{{ z.user.full_name | lower }}">
                <h3 style="color: #000;">{{ z.type }}</h3>
                <p style="color: #555;">{{ z.description }}</p>
                <p><strong>–î–∞—Ç–∞:</strong> <span style="color: #555;">{{ z.created_at.strftime('%d.%m.%Y %H:%M') }}</span></p>
                <p><strong>–°—Ç–∞—Ç—É—Å:</strong>
                    {% if z.status == '—Å–¥–µ–ª–∞–Ω–æ' %}
                    <span style="color: green;">–°–¥–µ–ª–∞–Ω–æ ‚úÖ</span>
                    {% elif z.status == '–æ–∂–∏–¥–∞–µ—Ç' %}
                    <span style="color: orange;">–û–∂–∏–¥–∞–µ—Ç üü°</span>
                    {% elif z.status == '–æ—Ç–∫–ª–æ–Ω–µ–Ω–æ' %}
                    <span style="color: red;">–û—Ç–∫–ª–æ–Ω–µ–Ω–æ üî¥</span>
                    {% else %}
                    <span style="color: gray;">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</span>
                    {% endif %}
                </p>
                <p><strong>–§–∞–∫—É–ª—å—Ç–µ—Ç:</strong> <span style="color: #555;">{{ z.user.faculty }}</span></p>
                <p><strong>–§–∞–π–ª:</strong>
                    {% if z.file %}
                        <a href="{{ url_for('uploaded_file', filename=z.file) }}" target="_blank" style="color: #007bff;">–°–∫–∞—á–∞—Ç—å</a>
                    {% else %}
                        <span style="color: #555;">–ù–µ—Ç —Ñ–∞–π–ª–∞</span>
                    {% endif %}
                </p>
                <p><strong>–ö—Ç–æ –æ—Å—Ç–∞–≤–∏–ª –∑–∞—è–≤–∫—É:</strong> <span style="color: #555;">{{ z.user.username }}</span></p>
                <form method="POST" action="/update_status">
                    <input type="hidden" name="id" value="{{ z.id }}">
                    <div class="status-buttons" style="display: flex; gap: 10px; margin-top: 10px;"> <!-- Flexbox layout -->
                        <button name="action" value="—Å–¥–µ–ª–∞–Ω–æ" class="btn compact-btn" style="background: #1cc88a;">–°–¥–µ–ª–∞–Ω–æ</button>
                        <button name="action" value="–æ–∂–∏–¥–∞–µ—Ç" class="btn compact-btn" style="background: #f6c23e;">–û–∂–∏–¥–∞–π—Ç–µ</button>
                        <button name="action" value="–æ—Ç–∫–ª–æ–Ω–µ–Ω–æ" class="btn compact-btn" style="background: #e74a3b;">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                        <button name="action" value="–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ" class="btn compact-btn" style="background: #858796;">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</button>
                    </div>
                </form>
                {% if z.comment %}
                <div class="comments-section" style="margin-top: 15px; max-height: 100px; overflow-y: auto; border: 1px solid #ddd; border-radius: 8px; padding: 10px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);">
                    <p style="font-size: 14px; color: #555;">{{ z.comment }}</p>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        {% else %}
            <p style="text-align: center; color: #888; font-size: 18px;">üîç –ó–∞—è–≤–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</p>
        {% endif %}
    </div>
</div>

<script>
    document.getElementById('apply-filters').addEventListener('click', function () {
        const typeFilter = document.getElementById('filter-type').value.toLowerCase();
        const statusFilter = document.getElementById('filter-status').value.toLowerCase();
        const queryFilter = document.getElementById('filter-query').value.toLowerCase();

        const cards = document.querySelectorAll('#request-list .card');

        cards.forEach(card => {
            const type = card.getAttribute('data-type').toLowerCase();
            const status = card.getAttribute('data-status').toLowerCase();
            const description = card.getAttribute('data-description').toLowerCase();
            const username = card.getAttribute('data-username').toLowerCase();
            const fullname = card.getAttribute('data-fullname').toLowerCase();

            const matchesType = !typeFilter || type.includes(typeFilter);
            const matchesStatus = !statusFilter || status.includes(statusFilter);
            const matchesQuery = !queryFilter || description.includes(queryFilter) || username.includes(queryFilter) || fullname.includes(queryFilter);

            if (matchesType && matchesStatus && matchesQuery) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    });
</script>
{% endblock %}